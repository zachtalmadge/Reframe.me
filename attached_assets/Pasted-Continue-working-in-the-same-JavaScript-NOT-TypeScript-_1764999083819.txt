Continue working in the same JavaScript (NOT TypeScript) + React + Tailwind CSS, mobile-first project using wouter for routing.
The app uses a multi-step form → Loading → Disclaimer → Documents flow, with form persistence handled via something like @/lib/formPersistence (loadFormData, saveFormData, etc.).

Current issues discovered:

On the Loading screen, clicking the logo in the top-left sends the user back to Home, but form data is still persisted.

On the Form pages, clicking the logo in the top-left also sends the user back to Home, and again the form data is still persisted when they go back into the flow.

On the Documents page, clicking the logo or using a “Start over” button returns to Home while form data remains; starting the flow again shows previous data.

High-level goals:

Any time the user leaves the in-progress flow via the logo on Form or Loading, they must see a confirmation that they will lose their data, and if they proceed, the form data must be cleared.

On the Documents page, the alert is not required, but form data must not be persisted (it should be cleared once generation succeeds and before starting over).

Overall, once the user leaves or completes the flow, form data should not persist into a new session.

Important for this fix:
For this change, DO NOT perform any end-to-end (e2e) tests or automated full-flow testing.
You may do manual/component-level checks only. I will confirm behavior in the UI.

Business requirement – Confirmation + clear data when leaving Form/Loading, and no persisted form data after success or “start over”

Implement the following behaviors:

Shared confirmation behavior on Form + Loading (logo click)

On any in-progress form step (e.g., /form and its internal steps) and on the Loading screen:

Clicking the logo in the top-left must not immediately navigate to Home.

Instead, it must open a Tailwind-styled confirmation modal/alert with:

Title, e.g.: “Leave and lose your information?”

Body text, e.g.:

“If you go back to the home page now, your information will be cleared and you will need to start over.”

Two buttons:

Cancel / Stay here → closes the modal and keeps the user on the current page (Form or Loading); no data is cleared.

Continue / Leave & clear data → clears persisted form data and navigates to the Home page (/).

This confirmation should be reused (same copy/behavior) for:

Any in-progress Form route.

The Loading route.

Clear form data after successful generation

When document generation succeeds in the Loading logic:

After generateDocuments(...) returns successfully and saveResults(result, tool) is called, clear the form data using the persistence helper (e.g., clearFormData() from @/lib/formPersistence).

This ensures that once documents are generated and results saved, the underlying form state is not kept around.

Documents page – Leaving the flow must always use cleared data

Once the user reaches the Documents page (after a successful generation + disclaimer), form data should already have been cleared in the success step above.

On the Documents page:

Clicking the logo in the top-left, or

Clicking a “Start over” button (or similar control that returns to Home)

Must:

Ensure form data is cleared (either already cleared from success, or call clearFormData() again for safety), and

Navigate to the Home page (/).

No confirmation modal is required on the Documents page for this prompt. The key requirement there is: no persisted form data once they leave.

Global guarantee: form data is not persisted into a new run

After:

The user completes a generation (success),

Or chooses to leave the flow via logo on Form or Loading,

Or uses “Start over” / logo on the Documents page,

Any subsequent return to the form must start with a completely fresh form (no previous answers restored).

Acceptance criteria (Given / When / Then)
Scenario: Logo click on any Form step triggers confirmation

Given the user is on any step of the Form (multi-step flow, /form?...)

When they click the logo in the top-left

Then:

A confirmation modal/alert appears with the “Leave and lose your information?” message.

They do not immediately navigate away.

Scenario: Logo click on Loading triggers same confirmation

Given the user is on the Loading screen and generation is in progress

When they click the logo in the top-left

Then:

The same confirmation modal appears (same title/body/buttons).

They do not immediately navigate away.

Scenario: Cancel keeps user and data (Form or Loading)

Given the confirmation modal is visible on a Form step or on Loading

When the user chooses Cancel / Stay here

Then:

The modal closes.

The user stays on the current page.

Form data remains intact; no clearing occurs.

Scenario: Continue clears data and navigates Home (Form or Loading)

Given the confirmation modal is visible on a Form step or on Loading

When the user clicks Continue / Leave & clear data

Then:

Persisted form data is cleared via the form persistence helper.

The user is navigated to the Home page (/).

If they start the form again, all fields begin empty/default.

Scenario: Form data cleared after successful generation

Given the user has successfully submitted the form and the server returns generated documents

When the Loading logic handles the successful result

Then:

The app calls saveResults(result, tool) (or equivalent) to store the generated narratives/documents.

Immediately afterwards, form data is cleared (e.g., clearFormData()), so no form state persists beyond this point.

Scenario: Leaving Documents page always uses cleared data

Given the user is on the Documents page after a successful generation

When they:

Click the logo in the top-left, or

Click a “Start over” button that returns to Home

Then:

Form data is already cleared from the success step (and may be cleared again for safety).

They are navigated to the Home page.

If they start the form again, no previous data is present.

What I want you (Replit AI) to do

Assess current logo behavior and form persistence

Inspect:

The Layout component that renders the logo and wraps the Form, Loading, and Documents pages.

How the logo click is currently wired (e.g., onClick with navigate("/")).

Inspect the form persistence utilities in @/lib/formPersistence:

Confirm the existence and behavior of saveFormData, loadFormData, clearFormData (or similar).

If clearFormData() does not exist, plan to implement it (e.g., removing a specific key from localStorage or similar).

Describe your understanding of the requirements

Explain in your own words:

On Form and Loading pages, logo click must open the same confirmation modal, not navigate immediately.

Confirming must clear form data and go Home; cancelling must keep them where they are.

After success, form data must be cleared so any navigation from Documents back to Home starts from a clean slate.

There is no confirmation modal required on Documents page for this prompt, but form data must not persist.

Identify key considerations to avoid breaking existing functionality

Ensure:

The Layout remains reusable; route-specific logo behavior (Form/Loading vs Documents) is handled cleanly (e.g., via props or route checks).

The multi-step form logic and validation remain unchanged, aside from this new “leave” path.

The Loading screen’s generation logic, error handling, and DisclaimerModal still work as before.

The Documents page still reads from saveResults, not from form state, so clearing form data does not affect docs display.

Propose best-practice UX and implementation for the confirmation

Use a reusable modal component or a simple inline modal pattern:

Backdrop: fixed inset-0 bg-black/40 flex items-center justify-center z-50.

Dialog: bg-white rounded-lg shadow-lg max-w-sm w-full mx-4 p-6.

Buttons:

Neutral/outline for Cancel / Stay here.

Primary or secondary (orange) button for Continue / Leave & clear data.

Behavior:

The modal should trap focus while open, and close on Cancel or successful Confirm.

Generate a step-by-step implementation plan

At a minimum include:

Step 1 – Persistence helper:

Confirm or implement clearFormData() in @/lib/formPersistence that removes any stored form state.

Step 2 – Clear form data on success:

In the Loading component’s startGeneration try block, after:

const result = await generateDocuments(...);

Confirmation that result.status !== "total_fail";

saveResults(result, tool);

Invoke clearFormData(); before setting status: "success" and showing the disclaimer.

Step 3 – Shared confirmation logic for Form + Loading logo:

Add a mechanism to override logo behavior when used by Form and Loading, for example:

Add an onLogoClick prop to Layout.

On Form and Loading pages, pass a handler that opens the modal instead of navigating directly.

In both Form and Loading components:

Maintain state showLeaveAlert (false initially).

handleLogoClick → setShowLeaveAlert(true).

handleConfirmLeave → clearFormData(); navigate("/");.

handleCancelLeave → setShowLeaveAlert(false);.

Render the confirmation modal when showLeaveAlert === true.

Step 4 – Ensure Documents page navigation clears data:

On the Documents page:

For the Start over button: handler should call clearFormData(); navigate("/");.

For the logo: if you override its click there, also ensure it calls clearFormData(); navigate("/");, or rely on already-cleared state.

No modal required here per this prompt.

Step 5 – Manual testing (no e2e):

Flow 1:

Start form → fill some steps → click logo → see modal → Cancel → stay, data intact.

Click logo again → modal → Continue → Home; restart form → fields empty.

Flow 2:

Complete form → Loading → click logo → get modal → Confirm → Home; restart → empty form.

Flow 3:

Complete form → Loading success → Disclaimer → Documents → click Start over → Home; restart → empty form.

Same with logo on Documents, if applicable.

Keep the scope limited

Do not:

Change server API behavior or document generation logic beyond clearing form data on success.

Alter any other modal or warning patterns outside this logo/leave flow.

Only adjust:

Form persistence behavior when leaving the flow.

Logo behavior on Form + Loading (with confirmation).

Navigation from Documents to ensure no persisted form data.

Propose a skeleton framework

Example for using Layout with an onLogoClick on Form/Loading:

// In Form or Loading component
const [showLeaveAlert, setShowLeaveAlert] = useState(false);
const [, navigate] = useLocation();

const handleLogoClick = () => setShowLeaveAlert(true);
const handleConfirmLeave = () => {
  clearFormData();
  navigate("/");
};
const handleCancelLeave = () => setShowLeaveAlert(false);

return (
  <Layout onLogoClick={handleLogoClick}>
    {/* page content */}

    {showLeaveAlert && (
      <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
        <div className="bg-white rounded-lg shadow-lg max-w-sm w-full mx-4 p-6">
          <h2 className="text-lg font-semibold">
            Leave and lose your information?
          </h2>
          <p className="mt-2 text-sm text-gray-700">
            If you go back to the home page now, your information will be
            cleared and you will need to start over.
          </p>
          <div className="mt-4 flex justify-end gap-2">
            <Button variant="outline" onClick={handleCancelLeave}>
              Stay here
            </Button>
            <Button onClick={handleConfirmLeave}>
              Leave &amp; clear data
            </Button>
          </div>
        </div>
      </div>
    )}
  </Layout>
);


And in the Documents page, ensure logout/start-over handlers call clearFormData() and navigate("/").

Do not run e2e tests

For this prompt:

You may update formPersistence, Layout, the Form component(s), Loading, and Documents as described.

You may perform manual checks / component-level tests.

Do NOT run or modify end-to-end (e2e) test suites; I will manually verify the behavior.